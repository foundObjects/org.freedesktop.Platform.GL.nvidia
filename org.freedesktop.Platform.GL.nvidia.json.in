{
    "id": "org.freedesktop.Platform.GL.nvidia-@@NVIDIA_VERSION@@",
    "branch": "@@SDK_BRANCH@@",
    "runtime": "org.freedesktop.Platform/x86_64/@@SDK_RUNTIME_VERSION@@",
    "build-extension": true,
    "sdk": "org.freedesktop.Sdk/x86_64/@@SDK_RUNTIME_VERSION@@",
    "runtime-version": "@@SDK_RUNTIME_VERSION@@",
    "sdk-extensions": [
        "org.freedesktop.Sdk.Compat.i386",
        "org.freedesktop.Sdk.Extension.toolchain-i386"
    ],
    "separate-locales": false,
    "cleanup": ["/include", "/share"],
    "build-options" : {
        "append-ld-library-path": "/usr/lib/x86_64-linux-gnu/GL/nvidia-@@NVIDIA_VERSION@@/lib",
        "cflags": "-O2 -g -I/usr/lib/x86_64-linux-gnu/GL/nvidia-@@NVIDIA_VERSION@@/include",
        "cxxflags": "-O2 -g",
        "prefix": "/usr/lib/x86_64-linux-gnu/GL/nvidia-@@NVIDIA_VERSION@@",
        "env": {
            "V": "1",
            "LDFLAGS": "-L/usr/lib/x86_64-linux-gnu/GL/nvidia-@@NVIDIA_VERSION@@/lib"
        },
        "arch": {
            "i386": {
                "append-path": "/usr/lib/sdk/toolchain-i386/bin",
                "env": {
                    "CC": "i686-unknown-linux-gnu-gcc",
                    "CXX": "i686-unknown-linux-gnu-g++",
                    "LD": "i686-unknown-linux-gnu-ld"
                }
            }
        }
    },
    "finish-args": [
        "--extra-data=@@EXTRA_DATA@@",
        "--metadata=Extra Data=NoRuntime"
    ],
    "modules": [
        {
            "cleanup": ["/lib/libzstd.so*"],
            "name": "libzstd",
            "no-autogen": true,
            "subdir": "lib",
            "make-args": [ "lib-mt" ],
            "make-install-args": [
                "PREFIX=${FLATPAK_DEST}",
                "LIBDIR=${FLATPAK_DEST}/lib",
                "install-static"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/facebook/zstd/releases/download/v1.5.4/zstd-1.5.4.tar.gz",
                    "sha256": "0f470992aedad543126d06efab344dc5f3e171893810455787d38347343a4424"
                }
            ]
        },
        {
            "name": "zlib",
            "config-opts": [ "--static" ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://prdownloads.sourceforge.net/libpng/zlib-1.2.11.tar.gz?download",
                    "sha256": "c3e5e9fdd5004dcb542feda5ee4f0ff0744628baf8ed2dd5d66f8ca1197cb1a1"
                }
            ]
        },
        {
            "name": "lzma",
            "config-opts": [ "--disable-shared" ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://tukaani.org/xz/xz-5.2.5.tar.xz",
                    "sha256": "3e1e518ffc912f86608a8cb35e4bd41ad1aec210df2a47aaa1f95e7f5576ef56"
                }
            ]
        },
        {
            "cleanup": ["/include", "/share"],
            "name": "libarchive",
            "config-opts": [ "--disable-shared", "--enable-static", "--disable-xattr", "--disable-acl",
                             "--without-bz2lib", "--without-iconv", "--without-lz4", "--without-lzo2", "--without-nettle",
                             "--without-openssl", "--without-xml2", "--without-expat", "--disable-bsdcat", "--disable-bsdcpio",
                             "--disable-bsdtar"
                           ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://www.libarchive.de/downloads/libarchive-3.6.2.tar.xz",
                    "sha256": "9e2c1b80d5fbe59b61308fdfab6c79b5021d7ff4ff2489fb12daf0a96a83551d"
                }
            ]
        },
        {
            "name": "ldconfig",
            "buildsystem": "simple",
            "build-commands": [
                "install -Dvm755 -t ${FLATPAK_DEST}/bin/ $(which ldconfig)"
            ]
        },
        {
            "name": "nvidia",
            "make-args": [ "NVIDIA_VERSION=@@NVIDIA_VERSION@@", "NVIDIA_URL=@@NVIDIA_URL@@" ],
            "no-autogen": true,
            "sources": [
                {
                    "type": "file",
                    "path": "nvidia-Makefile",
                    "dest-filename": "makefile"
                },
                {
                    "type": "file",
                    "path": "nvidia-apply-extra.c"
                }
            ]
        }
    ]
}
